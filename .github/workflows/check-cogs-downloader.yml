# For tests with nektos/act use:
# act -e .\.github\workflows\fixtures\push.json -W .\.github\workflows\check-cogs-downloader.yml --container-options "-v /c/privat/codex/d-cogs/.artifacts/dist:/tmp/dist:ro" --secret-file .secrets

# To test with local Red-DiscordBot build artifact, mount the host folder containing the built wheels to /tmp/dist in the container.
# docker run -it --rm -v /c/privat/codex/d-cogs/.artifacts/dist:/tmp/dist python:3.11 bash
name: "Check Cogs (Downloader)"

on:
  pull_request:

jobs:
  test-local-cogs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Red-DiscordBot
        run: |
          set -euo pipefail
          echo "ðŸ“¦ Installing Red-DiscordBot from PyPI"
          pip install Red-DiscordBot

      - name: Test cogs via Downloader
        uses: nntin/d-flows/actions/test-red-discordbot-downloader@v1.1.2
        with:
          token: ${{ secrets.DISCORD_BOT_TOKEN }}
          # cog_paths: ${{ env.COG_PATHS }}

  test-remote-cogs:
    runs-on: ubuntu-latest
    needs: test-local-cogs
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Red-DiscordBot
        run: |
          set -euo pipefail
          echo "ðŸ“¦ Installing Red-DiscordBot from PyPI"
          pip install Red-DiscordBot

      - name: Test cogs via Downloader
        uses: nntin/d-flows/actions/test-red-discordbot-downloader@v1.1.2
        with:
          token: ${{ secrets.DISCORD_BOT_TOKEN }}
          repo_url: https://c.csw.im/cswimr/SeaCogs.git
          repo_branch: main
